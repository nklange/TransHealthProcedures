---
title: "NHS Trans Health - Surgical Procedures and Interventions"
output:
  bookdown::html_document2
knit: (function(input_file, encoding) {
  out_dir <- 'docs';
  rmarkdown::render(input_file,
 encoding=encoding,
 output_file=file.path(dirname(input_file), out_dir, 'index.html'))})
bibliography: references.bib
link-citations: yes
csl: apa.csl
author: "Nicholas Lange (lange.nk@gmail.com)"
date: "Last updated on `r format(Sys.time(), '%B %d %Y')`"
---

# Disclaimer {-}

It is difficult to use fully inclusive language that captures the diversity of individuals' experiences, preferences and motivations when accessing 'trans health care' on the NHS. For clarity of language, I use a number of terminological short cuts when describing individuals and procedures throughout. Beyond these simplifications, I assume some general familiarity with trans terminology and experience throughout. I use gender-confirmation procedures where I refer to surgeries undergone by individuals who wish to change their appearance to achieve an appearance closer to the one they desire. In this context, these procedures typically include modifying stereotypically gender/sex-specific aspects of their bodies, hence gender-confirmation where confirmation indicates that the intent is to align the body with a particular identity. For transgender individuals, this is typically an appearance closer to their gender, rather than their sex. I use transgender men and women (male and female) frequently to describe individuals who may undergo these procedures. This is a simplification. Not all individuals undergoing these procedures will self-identify as transgender and/or see their experience as gender-confirmation. This binary view (of gender vs sex, male vs female for either) captures the nature of a lot of the data, and codes, but cannot reflect the variety in the individuals undergoing procedures. The same procedures are accessed by non-binary / a-gender and/or intersex individuals who may, not only, not be appropriately captured by a female or male gender marker but also have somewhat different motivations for undergoing these procedures.

# Background {-}

Over the last few years, discussions about the state of transgender health care under the NHS has received media attention. The focus of this attention is most acutely on the waiting lists to access a first appointment at one of the gender identity clinics (GICs) in the UK as the first step on the gender-confirmation pathway on the NHS [@Parsons_NHS_2020;@BBC_transgender_2021]. Some gender clinics now openly share their waitlist, such as the Gender Identity Clinic (formerly Charing Cross, now Tavistock and Portman) publishing that individuals being seen now (October 2021) were referred in October 2017 [@GIC_waiting_2021]. The information about waiting lists for other gender clinics is largely only made public by the trans community by word-of-mouth or as responses to Freedom-of-Information requests [@THUK_waiting_2021].

Naturally, while accessing a first appointment is an important step on the NHS pathway to treatment, it is typically only the first step on the pathway. Generally, individuals seen by a GIC do so to access hormones and/or surgical interventions, depending on personal preference. Following an initial, and possible follow-up appointments, as all procedures on the NHS, these similarly incur waiting times.

According to the NHS [@NHS_gender_nd], the surgeries that are common and routinely available for gender-confirmation on the NHS are: 

* bilateral mastectomy and associated chest reconstruction (incl., if necessary, nipple repositioning, dermal implants and tattoos)
* phalloplasty and metoidoplasty (construction of a penis, incl., if necessary, penile implants)
* scrotoplasty (construction of a scrotum) and testicular implants
* removal of the womb and/or ovaries and fallopian tubes (hysterectomy and/or salpingo-oophorectomy)

* removal of testes (orchidectomy)
* removal of penis (penectomy)
* construction of vagina (vaginoplasty), vulva (vulvoplasty) and clitoris (clitoroplasty)

While other surgeries are possible and offered in the private sector (such as facial feminising surgery), these are not routinely offered by the NHS. Not all transgender or gender non-conforming individuals seek any or all of the possible surgeries available to them, and individual preferences determine the details and extent of each surgery. Generally, referrals for these surgeries will be made by GICs for the individual when they are still under the care of a GIC at the time -- or by an individual's GP if they have already been discharged from a GIC.

While the number of individuals looking to access a GIC, and the associated length of the waiting list for initial treatment, are well-documented, the ease or difficulty of accessing treatment at a later stage of the pathway is not. In 2018, a Freedom-of-Information-Act (FOIA) request sent to the NHS, and subsequently published on NHS Digital [@NHSDigital_FOIA_2018], asked for information about the waiting time from referral to initial appointment for transgender people. The response is reproduced in Figure \@ref(fig:foia).


&nbsp;

```{r foia, fig.cap = "Response to Freedom-of-Information-Act request about waiting times for transgender procedures in 2018",out.width='100%', echo=FALSE}
knitr::include_graphics("Figures/FOIA_2018_letter.png")
```

&nbsp;

While the FOIA request specifically enquired about the waiting lists for an appointment at the GICs, rather than about further care, the response offered by NHS Digital referenced the "admissions and average waiting times for transgender surgeries on a national level" and referred the requestant to the "Procedures and Interventions" document published annually by NHS Digital as part of the "Hospital Admitted Patient Care Activity" report [@HAPCA].

These hospital admissions statistics of individual-level records aggregated across procedures and diagnoses respectively are available via NHS Digital for a number of recent years. As stated in the introduction of these statistics, "[t]he purpose of [these published statistics] is to inform and support strategic and policy-led processes for the benefit of patient care. This document will also be of interest to researchers, journalists and members of the public interested in NHS hospital activity in England" [@HAPCA_2021]. The response to the FOIA request suggests that the information about the waiting time from referral to intervention for transgender individuals is available in these documents. The purpose of this write-up is therefore to use this publically available data to briefly document how the prevalence of procedures for gender-confirmation and associated waiting times has changed across recent years.

# Procedures and Interventions {-}

## Method {-}

For the analyses here, I downloaded the "Hospital Episode Statistics for England. Admitted Patient Care statistics: Procedures and Interventions" published by NHS Digital [@HAPCA]. The analyses here focus on the period from 2011 to 2021 inclusive (that is from the financial year 2011-2012 to the financial year 2020-2021) and reflect the procedures at NHS hospitals. The data in the document is aggregated across individual records and show the 'Finished Consultant Episodes' from the Hospital Episodes Statistics (HES) data warehouse. One of these episodes indicates a period of care for a patient under a single consultant at a single hospital. The reports available therefore count the number of episodes of care for admitted patients rather than provide the number of patients (i.e., a single patient could have multiple episodes). A stay in hospital from admission to discharge is called a ‘spell’ and can be made up of one or more episodes of care. FCEs therefore indicate a continuous period of care under one consultant during that spell. Not all FCEs result in admission to hospital, so admissions are recorded separately to FCEs.

While some gender-confirmation procedures will incur multiple stays in hospital and potentially multiple consultants during a single stay, the majority will be associated with a single hospital stay. At the same time, while a single patient can be associated with multiple episodes under different consultants, this is unlikely for gender-confirmation surgeries within the same year (though not impossible when accounting for revisions in complex surgeries). Therefore, while finished consultant episodes may not necessarily be equal to the number of patients undergoing a particular procedure, it is improbable that the numbers deviate significantly.

Procedures and interventions are classified using OPCS-4 codes (most recent: OPCS-4.9). The FOIA response in Figure \@ref(fig:foia) suggests that the relevant codes for gender-confirmation surgeries in 'Procedures and Interventions' are:

* X15.1 Combined operations for transformation from male to female
* X15.2 Combined operations for transformation from female to male
* X15.4 Construction of scrotum
* X15.8 Other specified operations for sexual transformation
* X15.9 Unspecified operations for sexual transformation

Given the list of procedures available on the NHS I listed earlier, it is not clear which procedures are intended to fall under 'combined operations [...]', 'other specificed operations [...]' or 'unspecified operations [...]' and are coded as such. The procedures routinely availble under the NHS for transgender individuals differ in the complexity of the surgery. It is rather unique to transgender individuals to have a phalloplasty in combination with hysterectomy, or a vaginoplasty in combination with the removal of a penis. It is possible that these are 'combined operations [...]' that the X15.1 and X15.2 codes are meant for. The four surgeries in isolation, however, are not only undergone by transgender individuals individually who may not desire the combined operation, but are also undergone by cisgender individuals for a different set of reasons.

For the further analysis, I extracted the data associated with the above OPCS-4 codes where these codes were given as the primary procedure in a particular FCE.

## Caveats about data coding and gender markers {-}

In the dictionary for HES records, the gender associated with a particular record is given by the 'Current Gender of Patient', with the explanation that the "classification is phenotypical rather than genotypical, i.e. it does not provide codes for medical or scientific purposes", where aside from 'female' and 'male, individuals can be coded as 'Not Known' "where the sex of a person has not been recorded" or 'Not Specified' where the person is "unable to be classified as either male or female" [@HES_dictionary_2021]. In the Hospital Admitted Patient Care Statistics, the gender of individuals is recorded as 'Female', 'Male' or 'Unknown', only. It is unclear whether the latter category combines 'Not Known' and 'Not Specified'. Even with a phenotypical rather than genotypical coding of gender, for gender-confirmation procedures the analysis of the distribution across gender thus comes with a number of caveats.

In 'Procedures and Interventions' a number of sex-specific procedures and interventions are marked-up where individuals with either gender-marker are recorded as having undergone the procedure to flag possible coding errors. While in some cases this may be coding errors, in other cases it may simply be transgender or intersex individuals undergoing procedures not for the purpose of gender-confirmation but for other medical reasons, i.e., a male-identified individual undergoing removal of a lesion on the uterus or ovaries.

For transgender individuals, the gender marker in their NHS record (which is likely going to be the marker in the majority of HES records) could reflect the gender or the sex depending on personal preference or administrative constraints in changing the record to the preferred gender. Individuals can change the gender associated with their NHS record by changing their gender by deed poll and submitting this to their GP without requiring any formal documentation (such as diagnoses by clinicians in gender clinics). In any individual case this may not be possible due to safety concerns by the individual or administrative restrictions on the side of the GP practice. Anecdotally, some hospitals allow patients to determine their gender as 'U' on hospital tags and so forth for the duration of their stay. It is unclear whether that is reflected in the records by assigning 'gender: unknown' for those episodes or whether the record reverts to the gender marker on the NHS record.

Note for 2011/12, only 'Gender: Male' was specified, with the implication that the remainder of FCEs would be 'Gender: Female'. Throughout, I use 'Gender: N/A' to indicate these data, as it may simply indicate data coded as 'Gender: Female' or 'Gender: Unknown' + 'Gender: Female'.

Examinining the X15 procedure codes over the years, overwhelmingly individuals assigned female at birth appear to be coded as 'male', and individuals assigned male at birth as 'female', reflecting the individuals' gender, within binary constraints, rather than sex. For the purpose of this write-up we will assume that individuals assigned female at birth seeking gender confirmation were coded as 'male' for all procedures, and individuals assigned male at birth as 'female'. Given the above caveats this is not necessarily true, and we will see this in the data, but it is likely true for the majority of recorded episodes.

## Analysis {-}

```{r code,echo=FALSE,message=FALSE,error=FALSE,warning=FALSE}

library(stringr)
library(dplyr)
library(tidyr)
library(magrittr)
library(purrr)
library(readr)
library(tibble)
library(ggplot2)
library(ggpattern)
library(cowplot)

footnote <- function(codes) { 
  
  c(codes,paste0("‡ ",codes),paste0("‡",codes))
    
    }


#OSPC4
transproc <- c("X15.1","X15.2","X15.4","X15.8","X15.9")
procedurecodes <- footnote(transproc)

mastectomyproc <-c("B27.4","B27.5","B27.6")
phalloplastyproc <- "N28.1"
hysterproc <- c("Q07.3","Q07.4","Q07.5","Q07.8","Q07.9",
                "Q08.3","Q08.8","Q08.9",
                "Q22.1","Q22.2","Q22.3",
                "Q24.1","Q24.2","Q24.3")
orchidectomyproc <- c("N05.1","N05.2","N05.3","N05.8","N06.3")
penectomyproc <-  c("N26.1","N26.2","N26.8","N26.9")
vagplasty <- c("P21.2","P21.3","P21.5")
oocyte <- c("Q48.1","Q48.2","Q48.3","Q48.4","Q48.8","Q48.9")

sperm <- c("N34.1","N34.2","N34.4","N34.5","N34.6","N34.8")


altcodes <- footnote(c(mastectomyproc,phalloplastyproc,hysterproc,orchidectomyproc,penectomyproc,
                       vagplasty,oocyte,sperm))


#ICD10
transdiag <- c("F64.0","F64.1","F64.2","F64.8","F64.9")

CollectedData <- readRDS("ProcessedData/ProceduresDiag.rds")
relevantcol <- c("year","type","Code","Description","FinEpisodes","Admissions",
                 "GenderMale","GenderFemale","GenderUnknown",
                 "MeanWaiting","MedianWaiting","MeanStay","MedianStay")
yearlabels <- stringr::str_replace_all(unique(CollectedData$year),"to","-")
diaglabels <- c("F64.0\nTranssexualism","F64.1\nDual-role transvestism","F64.2\nGID childhood","F64.8\nOther GIDs","F64.9\nGID, unspecified")
  

```

```{r code2,echo=FALSE,message=FALSE,error=FALSE,warning=FALSE}


totalproc <- CollectedData %>% filter(type=="Procedures") %>% 
  select(relevantcol) %>% 
  select(c("year","type","Code","Description","FinEpisodes",
           "GenderMale","GenderFemale","GenderUnknown")) %>% 
  mutate(across(c("FinEpisodes","GenderMale","GenderFemale","GenderUnknown"),as.numeric)) %>% 
  replace_na(list(GenderFemale=0,GenderUnknown=0)) %>% 
  mutate(NotProvided = FinEpisodes - GenderMale - GenderFemale -GenderUnknown) %>% 
  
  pivot_longer(cols=c("GenderMale","GenderFemale","GenderUnknown","NotProvided"),names_to="gender",values_to="value") %>% 
  group_by(year,gender) %>% 
  mutate(value = as.numeric(value),
         FinEpisodes = as.numeric(FinEpisodes)) %>% 
  summarize(totalep = sum(FinEpisodes,na.rm=T),
            sumvalue = sum(value,na.rm=T)) %>% 
  mutate(gender= factor(gender,levels=rev(c("GenderMale","GenderUnknown","GenderFemale","NotProvided")),
                        labels=rev(c("Male","Unknown","Female","N/A"))))


proclabels <- c("X15.1\nTransformation from\nmale to female",
                "X15.2\nTransformation from\nfemale to male",
                "X15.4\nConstruction\nof scrotum",
                "X15.8\nOther specified operations\nfor sexual transformation",
                "X15.9\nUnspecified operations\nfor sexual transformation")

totalprocbytype <- CollectedData %>% filter(type=="Procedures") %>% 
  select(relevantcol) %>% 
 
  mutate(across(c("FinEpisodes","GenderMale","GenderFemale","GenderUnknown","MedianWaiting"),as.numeric)) %>% 
  replace_na(list(GenderFemale=0,GenderUnknown=0)) %>% 
  mutate(NotProvided = FinEpisodes - GenderMale - GenderFemale -GenderUnknown) %>% 
  
  pivot_longer(cols=c("GenderMale","GenderFemale","GenderUnknown","NotProvided"),names_to="gender",values_to="value") %>% 
  group_by(year,Code,gender) %>% 
  mutate(value = as.numeric(value),
         FinEpisodes = as.numeric(FinEpisodes)) %>% 
  summarize(totalep = sum(FinEpisodes,na.rm=T),
            sumvalue = sum(value,na.rm=T)) %>% 
  mutate(gender= factor(gender,levels=rev(c("GenderMale","GenderUnknown","GenderFemale","NotProvided")),
                        labels=rev(c("Male","Unknown","Female","N/A")))) %>% 
  mutate(Code = factor(Code,levels=transproc[1:5],labels=proclabels))



totalproc_bytype<-ggplot(totalprocbytype, aes(x = sumvalue, y= year, fill = gender,label=ifelse(sumvalue == 0, "",sumvalue))) + 
  # geom_bar(data=totaldiag %>% filter(gender=="Male"), aes(x=totalep,y=year),
  #          fill="grey",color="black",stat="identity")+
  facet_grid(.~Code,scales = "free")+
  geom_bar(stat="identity",color="black")+
  geom_text(size = 3, position = position_stack(vjust = 0.5))+
  
  # geom_bar(data=totaldiag %>% filter(gender=="Male"), aes(x=totalep,y=year),
  #          fill="transparent",color="black",stat="identity")+
  
  scale_y_discrete(labels = yearlabels,name="Period")+
  scale_x_continuous(name="Finished Consultant Episodes")+
  #coord_flip() + 
  scale_fill_manual(name="Gender Marker",values=c("#FC8D62","#E78AC3","#66C2A5","#8DA0CB")) + 
  theme_bw()+
  theme(axis.text= element_text(size=14),
        axis.title= element_text(size=14),
        legend.text = element_text(size=14),
        strip.text = element_text(size=14),
        legend.title  = element_text(size=14))


associateddata <- CollectedData %>% filter(type=="Procedures") %>% 
  select(year,type,Code,
         FinEpisodes,Admissions,
         Emergency,WaitingList,Planned,OtherAdmission,
         MedianWaiting,MedianStay,
         DayCase) %>% 
 
  mutate(across(c("FinEpisodes","Admissions","Emergency","WaitingList","Planned",
                  "OtherAdmission","MedianWaiting","MedianStay","DayCase"),as.numeric)) %>% 
  replace_na(list(Planned=0,OtherAdmission=0,Emergency=0))


admissiontype <-  associateddata %>% 
  select(c("year","type","Code","FinEpisodes","Admissions","Emergency","WaitingList","Planned",
                  "OtherAdmission" )) %>% 
  mutate(OtherAdmission = ifelse(Admissions !=  Emergency + WaitingList + Planned + OtherAdmission,
                                 Admissions - (Emergency + WaitingList + Planned + OtherAdmission),
                                 OtherAdmission)) %>% 
  pivot_longer(cols=c("Emergency","WaitingList","Planned","OtherAdmission"),names_to="Admission",values_to="value") %>% 
  group_by(year,Code) %>% 

  mutate(Code = factor(Code,levels=transproc[1:5],labels=proclabels))


admissions_graph <- ggplot(admissiontype, aes(x = value, y= year, fill = Admission)) + 
  # geom_bar(data=totaldiag %>% filter(gender=="Male"), aes(x=totalep,y=year),
  #          fill="grey",color="black",stat="identity")+
  facet_grid(.~Code,scales = "free")+
  
  geom_bar(data = admissiontype %>% select(year,Code,FinEpisodes) %>% distinct() %>% rename("value"=FinEpisodes),fill="transparent",color="black",linetype="dashed",position=position_dodge(0.9),stat="identity")+
  
  geom_bar(data=admissiontype, aes(x = value, y= year, fill = Admission,label=ifelse(value == 0, "",value)),
stat="identity",color="black")+
  geom_text(data=admissiontype, aes(x = value, y= year, fill = Admission,label=ifelse(value == 0, "",value)),size = 3, position = position_stack(vjust = 0.5))+
  # geom_bar(data=totaldiag %>% filter(gender=="Male"), aes(x=totalep,y=year),
  #          fill="transparent",color="black",stat="identity")+
  
  scale_y_discrete(labels = yearlabels,name="Period")+
  scale_x_continuous(name="Finished Consultant Episodes")+
  #coord_flip() + 
  scale_fill_manual(name="Admissions",values=c("#FC8D62","#E78AC3","#66C2A5","#8DA0CB")) + 
  theme_bw()+
  theme(axis.text= element_text(size=14),
        axis.title= element_text(size=14),
        legend.text = element_text(size=14),
        strip.text = element_text(size=14),
        legend.title  = element_text(size=14))

daycases <- associateddata %>% 
  select(c("year","type","Code","FinEpisodes","DayCase","MedianStay","MedianWaiting")) %>% 
  group_by(year,Code) %>% 

  mutate(Code = factor(Code,levels=transproc[1:5],labels=proclabels))



daycase_graph <- ggplot(daycases, aes(x = DayCase, y= year)) + 
  # geom_bar(data=totaldiag %>% filter(gender=="Male"), aes(x=totalep,y=year),
  #          fill="grey",color="black",stat="identity")+
  facet_grid(.~Code,scales = "free")+
  
  geom_bar(data = daycases %>% select(year,Code,FinEpisodes) %>% distinct() %>% rename("DayCase"=FinEpisodes),fill="transparent",color="black",linetype="dashed",position=position_dodge(0.9),stat="identity")+
  
  geom_bar(data=daycases, aes(x = DayCase, y= year),fill="#FFD92F",
stat="identity",color="black")+
  geom_text(data=daycases, aes(x = DayCase, y= year, label=ifelse(DayCase == 0, "",DayCase)),
            size = 3, position = position_stack(vjust = 0.5))+
  # geom_bar(data=totaldiag %>% filter(gender=="Male"), aes(x=totalep,y=year),
  #          fill="transparent",color="black",stat="identity")+
  
  scale_y_discrete(labels = yearlabels,name="Period")+
  scale_x_continuous(name="Finished Consultant Episodes")+ 
  theme_bw()+
  theme(axis.text= element_text(size=14),
        axis.title= element_text(size=14),
        legend.text = element_text(size=14),
        strip.text = element_text(size=14),
        legend.title  = element_text(size=14))


stay_graph <- ggplot(daycases, aes(x = MedianStay, y= year)) + 
  # geom_bar(data=totaldiag %>% filter(gender=="Male"), aes(x=totalep,y=year),
  #          fill="grey",color="black",stat="identity")+
  facet_grid(.~Code)+
  
  geom_bar(data=daycases, aes(x = MedianStay, y= year),fill="#FFD92F",
stat="identity",color="black")+
  geom_text(data=daycases, aes(x = MedianStay, y= year, label=ifelse(MedianStay == 0, "",MedianStay)),
            size = 3, position = position_stack(vjust = 0.5))+
  # geom_bar(data=totaldiag %>% filter(gender=="Male"), aes(x=totalep,y=year),
  #          fill="transparent",color="black",stat="identity")+
  
  scale_y_discrete(labels = yearlabels,name="Period")+
  scale_x_continuous(name="Median Hospital Stay (in days)")+ 
  theme_bw()+
  theme(axis.text= element_text(size=14),
        axis.title= element_text(size=14),
        legend.text = element_text(size=14),
        strip.text = element_text(size=14),
        legend.title  = element_text(size=14))


WaitingTimesbytype <- ggplot(daycases %>% select(year,Code,MedianWaiting) %>% distinct() , 
                             aes(x = MedianWaiting/7, y= year,
                                 label=ifelse(MedianWaiting == 0, "",round(MedianWaiting/7,1)))) + 
  # geom_bar(data=totaldiag %>% filter(gender=="Male"), aes(x=totalep,y=year),
  #          fill="grey",color="black",stat="identity")+
  facet_grid(.~Code)+
  geom_bar(stat="identity",color="black",fill="#FFD92F" )+
  geom_text(size = 3, position = position_stack(vjust = 0.5))+
  
  # geom_bar(data=totaldiag %>% filter(gender=="Male"), aes(x=totalep,y=year),
  #          fill="transparent",color="black",stat="identity")+
  
  scale_y_discrete(labels = yearlabels,name="Period")+
  scale_x_continuous(name="Median Waiting Time (in weeks)")+
  #coord_flip() + 
 
  theme_bw()+
  theme(axis.text= element_text(size=14),
        axis.title= element_text(size=14),
        legend.text = element_text(size=14),
        legend.title  = element_text(size=14),
        strip.text = element_text(size=14))

detailgraph <- plot_grid(admissions_graph,daycase_graph,stay_graph,WaitingTimesbytype, nrow=4,labels ="AUTO")


```

Following the freedom-of-information-act request, I examined the codes associated with gender-confirming procedures in the Procedures and interventions document. Figure \@ref(fig:procedures) shows the procedures by procedure code and year, and by the distribution of gender markers across procedures. Generally, this appears to confirm that the gender marker coded in the NHS documents largely agrees with the preferred gender of individuals, with "transformation from male to female" mostly associated with episodes assigned a female gender marker, and procedures associated with "transformation from female to male" a male gender marker.

&nbsp;
```{r procedures, fig.cap = "FCEs within the X15-group (by code) by year and gender. Note, 'N/A' indicates FCEs not coded as 'Male'.",out.width='100%', echo=FALSE,fig.height=5,fig.width=15}
totalproc_bytype
```
&nbsp;

Given the procedures, we can examine some characteristics of these procedures, i.e., how many of the procedures resulted in admission to hospital, the number of day cases, and the  waiting times and length of hospital stay associated with the FCEs for these procedures. As the data is aggregated across episodes, it is not possible to provide a more fine-grained analysis than on the level of the procedure-code. Figure \@ref(fig:proceduredetails)A shows that virtually all FCEs result in admissions to hospitals with the vast majority being waiting list admissions, and Figure \@ref(fig:proceduredetails)B shows that virtually all episodes were associated with an overnight stay. The median length of stay is a week for the majority of procedures, but considerably shorter for procedures coded as X15.2 (transformation from female to male), see Figure \@ref(fig:proceduredetails)C. 

Figure \@ref(fig:proceduredetails)D shows the median waiting time for each procedure. Ignoring 2020-21, for X15.1 waiting times have reduced over last few years. For the most recent reliable period, accessing a X15.1 procedure required a waiting time of eight weeks and X15.8 of 10 weeks. The waiting time for X15.2 procedures are considerably longer. With the caveat that the number are much smaller for this category - and hence any associated characteristics are far less reliable - waiting times were approximately three times longer.


&nbsp;

```{r proceduredetails, fig.cap = "Information associated with FCEs for gender-confirmation procedures. Note, in A. and B. the scales differ for each procedure code, and dashed lines indicate the total number of FCEs. A. Type of admission.  B. Number of day cases without overnight stay. C. Median Waiting Time (in weeks). D. Median length of hospital stay (in days).",out.width='100%', echo=FALSE,fig.height=16,fig.width=15}
detailgraph
```

&nbsp;

It is not possible to show the mean age of individuals undergoing these procedures as the mean age (and distribution across age bands) is redacted from the documents. The same appears to be true for some other codes largely relating to HIV tests (U32.1) or antiretroviral therapy (X86.6) and fertility (Q13, O38, N34). The other cases where age information is missing appear to be procedures with a low number of episodes, where data may simply not have been recorded or age is redacted to protect anonymity.

As far as hospital episodes coded as procedures for the purpose of gender-confirmation go, this is the information available in the aggregated HES records. What is particularly striking is the low number of gender-confirmation procedures undergone by individuals with a male gender marker. Ignoring 2020-21 as a possible outlier, these numbers suggest that, for example, in 2019-20, only thirteen individuals with a male gender-marker underwent a gender-confirmation procedure, compared to 324 individuals with a female gender marker.

## Open question: Where does that imbalance come from? {-}

On the face of it, far more transgender women appear to undergo procedures for gender-confirmation than transgender men on the NHS. So what are the possible reasons for that pattern in the statistics?

A possible explanation is that the gender-coding of the HES records do not accurately reflect the individuals' gender. This does not seem to explain the pattern, as we do have separate procedure codes for the transformation from male to female (X15.1) and the transformation from female to male (X15.2). Ignoring the other two procedure codes, the disparity in the FCEs associated with these procedures alone shows a numerical imbalance. This is confirmed when considering the gender markers associated with these episodes as I showed in Figure\@ref(fig:procedures).

A second possibility is that there are simply more female than male transgender individuals. Yet, this is not true. In the National LGBT Survey (@-LGBTSurvey_2019), of ~100,000 respondents, 13% self-identified as transgender, with 3.5% identifying as women, 2.9% as men, and 6.9% as non-binary. This means it is unlikely that the imbalance in the gender markers accessing procedures is a result of there being more female than male transgender individuals.

A third possibility is that transgender women are more likely to acess surgical procedures. Self-reports and surverys conducted on social media suggest that this is not the case. In a review of the literature @Nolan_Demographic_2019 suggests that transgender males are in fact more likely to access surgical solutions than transgender females, though less likely to undergo genital surgery. The usual caveats apply that self-selection (by participants in online forums that discuss transgender identities, and participation in surveys) and geographical bias (of how easy it is to access surgical procedures) play a role in any individual study. Thus it does not necessarily mean that in the UK, the same is true. As a procedure for gender-confirmation should require a primary diagnosis of gender dysphoria / gender identity disorder, I will first examine the diagnoses associated with the hospital episodes to examine how frequently the relevant diagnoses are given.

# Diagnoses {-}

## Method {-}

In addition to 'Procedures and Interventions', NHS Digital also publishes "Hospital Episode Statistics for England. Admitted Patient Care statistics: Diagnosis" in the same series [@HAPCA]. Here FCEs are classified by the diagnoses (primary and secondary) that presented the reasons for a particular consultant episodes (and possibly admission) to hospital. Perhaps counter-intuitively, but critically, the total number of FCEs differs across the 'Diagnosis' and 'Procedures and Interventions', with the 'Diagnosis' document including approximately 50% more FCEs than the 'Procedure and Interventions' document. This is likely because admittance to hospital is not necessarily associated with a particular procedure or intervention but could still result in a diagnosis. The documents provide no information what that non-procedure is, i.e., if it is a consultation without a particular medical test that could be recorded such a pre-operative appointment with a consultant, an admittance for observation without a procedure being undergone, or an otherwise diagnostic appointment that is not recorded as a procedure. This makes inferences about individuals on the basis of episodes associated with a particular primary diagnosis even more difficult than is the case for procedures.

To get a sense of the number of FCEs associated with diagnoses that relate to gender-confirmation, I will examine the Diagnosis document. Diagnoses are coded using ICD-10. The codes relevant to gender-confirmation are in the F64 group:

* F64.0	Transsexualism
* G64.1 Dual role transvestism
* F64.2	Gender identity disorder (GID) of childhood
* F64.8	Other GIDs
* F64.9	GID, unspecified

For the further analysis, I extracted the data associated with the above ICD-10 codes where these codes were given as the primary diagnosis in a particular FCE.

## Analysis {-}

Figure \@ref(fig:diag) shows the number of diagnoses in the F64 group associated with finished consultant episodes across the time periods between 2011/2012 and 2020/2021. In addition to the total number of diagnoses, the graph also shows the gender marker assigned to the FCEs that are associated with particular diagnoses. Figure \@ref(fig:diagtype) splits this graph into the specific F64.x diagnoses (note the difference in scales).

```{r code7, echo=FALSE,warning=FALSE,error=FALSE,message=FALSE}

# gender diagnoses

totaldiag <- CollectedData %>% filter(type=="Diagnoses") %>% 
  select(relevantcol) %>% 
  select(c("year","type","Code","Description","FinEpisodes",
           "GenderMale","GenderFemale","GenderUnknown")) %>% 
  mutate(across(c("FinEpisodes","GenderMale","GenderFemale","GenderUnknown"),as.numeric)) %>% 
  replace_na(list(GenderFemale=0,GenderUnknown=0)) %>% 
  mutate(NotProvided = FinEpisodes - GenderMale - GenderFemale -GenderUnknown) %>% 

  pivot_longer(cols=c("GenderMale","GenderFemale","GenderUnknown","NotProvided"),names_to="gender",values_to="value") %>% 
  group_by(year,gender) %>% 
  mutate(value = as.numeric(value),
         FinEpisodes = as.numeric(FinEpisodes)) %>% 
  summarize(totalep = sum(FinEpisodes,na.rm=T),
            sumvalue = sum(value,na.rm=T)) %>% 
  mutate(gender= factor(gender,levels=rev(c("GenderMale","GenderUnknown","GenderFemale","NotProvided")),
                        labels=rev(c("Male","Unknown","Female","N/A"))))

diag<-ggplot(totaldiag, aes(x = sumvalue, y= year, fill = gender,label=ifelse(sumvalue == 0, "",sumvalue))) + 
  # geom_bar(data=totaldiag %>% filter(gender=="Male"), aes(x=totalep,y=year),
  #          fill="grey",color="black",stat="identity")+
  geom_bar(stat="identity",color="black")+
  geom_text(size = 3, position = position_stack(vjust = 0.5))+
  
  # geom_bar(data=totaldiag %>% filter(gender=="Male"), aes(x=totalep,y=year),
  #          fill="transparent",color="black",stat="identity")+

  scale_y_discrete(labels = yearlabels,name="Period")+
  scale_x_continuous(name="Finished Consultant Episodes")+
 #coord_flip() + 
  scale_fill_manual(name="Gender Marker",values=c("#FC8D62","#E78AC3","#66C2A5","#8DA0CB")) + 
  theme_bw()

# gender diagnosis by type


totaldiag_type <- CollectedData %>% filter(type=="Diagnoses") %>% 
  select(relevantcol) %>% 
  select(c("year","type","Code","Description","FinEpisodes",
           "GenderMale","GenderFemale","GenderUnknown")) %>% 
  mutate(across(c("FinEpisodes","GenderMale","GenderFemale","GenderUnknown"),as.numeric)) %>% 
  replace_na(list(GenderFemale=0,GenderUnknown=0)) %>% 
  mutate(NotProvided = FinEpisodes - GenderMale - GenderFemale -GenderUnknown) %>% 
  
  pivot_longer(cols=c("GenderMale","GenderFemale","GenderUnknown","NotProvided"),names_to="gender",values_to="value") %>% 
  group_by(year,Code,gender) %>% 
  mutate(value = as.numeric(value),
         FinEpisodes = as.numeric(FinEpisodes)) %>% 
  summarize(totalep = sum(FinEpisodes,na.rm=T),
            sumvalue = sum(value,na.rm=T)) %>% 
  mutate(gender= factor(gender,levels=rev(c("GenderMale","GenderUnknown","GenderFemale","NotProvided")),
                        labels=rev(c("Male","Unknown","Female","N/A")))) %>%  
  mutate(Code = factor(Code,levels=transdiag,
                       labels=diaglabels))

totaldiag_bytype<-ggplot(totaldiag_type, aes(x = sumvalue, y= year, fill = gender,label=ifelse(sumvalue == 0, "",sumvalue))) + 
  # geom_bar(data=totaldiag %>% filter(gender=="Male"), aes(x=totalep,y=year),
  #          fill="grey",color="black",stat="identity")+
  facet_grid(.~Code,scales = "free")+
  geom_bar(stat="identity",color="black")+
  geom_text(size = 3, position = position_stack(vjust = 0.5))+
  
  # geom_bar(data=totaldiag %>% filter(gender=="Male"), aes(x=totalep,y=year),
  #          fill="transparent",color="black",stat="identity")+
  
  scale_y_discrete(labels = yearlabels,name="Period")+
  scale_x_continuous(name="Finished Consultant Episodes")+
  #coord_flip() + 
  scale_fill_manual(name="Gender Marker",values=c("#FC8D62","#E78AC3","#66C2A5","#8DA0CB")) + 
  theme_bw()+
  theme(axis.text= element_text(size=14),
        axis.title= element_text(size=14),
        legend.text = element_text(size=14),
        strip.text = element_text(size=14),
        legend.title  = element_text(size=14))

```

&nbsp;

```{r diag, fig.cap = "Number of F64 diagnoses by year",out.width='70%', echo=FALSE,warning=FALSE,error=FALSE}

diag
```

&nbsp;


```{r diagtype, fig.cap = "Number of F64-group diagnoses by diagnosis and year",out.width='100%', echo=FALSE,fig.height=5,fig.width=15}
totaldiag_bytype
```
&nbsp;

The main takeaways: The number of episodes associated with a primary diagnosis of F64 has increased since 2011. The most recent 2020/2021 report forms an outlier from this pattern, most likely due to restrictions during the Covid-19 pandemic. While the increase in episodes is most marked for individuals associated with a male gender marker, the trend is largely matched by the other groups. Interestingly, in contrast to the procedures associated with a consultant episode, here episodes associated with a male gender marker outnumber those with a female gender marker.

The generic F64.0 diagnosis is the most common across all years, with the remaining categories used much less frequently. Despite the lower overall number of episodes in the most recent period, the use of the 'F64.9 Gender identity disorder, unspecified' category makes up a relatively larger chunk, with a considerable number of episodes associated with the gender 'unknown'. This is a departure from previous years.

So how does the pattern in the diagnoses not translate into the same pattern in the procedures associated with gender-confirmation which, logic dictates, should be the prime candidate procedures when a primary diagnosis of gender identity disorder is given (and a procedure is associated with the episode)?

```{r code5,echo=FALSE,message=FALSE,error=FALSE,warning=FALSE}


associateddataD <- CollectedData %>% filter(type=="Diagnoses") %>% 
  select(year,type,Code,
         FinEpisodes,Admissions,
         Emergency,WaitingList,Planned,OtherAdmission,
         MedianWaiting,MedianStay,
         DayCase) %>% 
 
  mutate(across(c("FinEpisodes","Admissions","Emergency","WaitingList","Planned",
                  "OtherAdmission","MedianWaiting","MedianStay","DayCase"),as.numeric)) %>% 
  replace_na(list(Planned=0,OtherAdmission=0,Emergency=0))


admissiontypeD <-  associateddataD %>% 
  select(c("year","type","Code","FinEpisodes","Admissions","Emergency","WaitingList","Planned",
                  "OtherAdmission" )) %>% 
  mutate(OtherAdmission = ifelse(Admissions !=  Emergency + WaitingList + Planned + OtherAdmission,
                                 Admissions - (Emergency + WaitingList + Planned + OtherAdmission),
                                 OtherAdmission)) %>% 
  pivot_longer(cols=c("Emergency","WaitingList","Planned","OtherAdmission"),names_to="Admission",values_to="value") %>% 
  group_by(year,Code) %>% 
  mutate(Code = factor(Code,levels=transdiag,
                       labels=diaglabels))


admissions_graphD <- ggplot(admissiontypeD, aes(x = value, y= year, fill = Admission)) + 
  # geom_bar(data=totaldiag %>% filter(gender=="Male"), aes(x=totalep,y=year),
  #          fill="grey",color="black",stat="identity")+
  facet_grid(.~Code,scales = "free")+
  
  geom_bar(data = admissiontypeD %>% select(year,Code,FinEpisodes) %>% distinct() %>% rename("value"=FinEpisodes),fill="transparent",color="black",linetype="dashed",position=position_dodge(0.9),stat="identity")+
  
  geom_bar(data=admissiontypeD, aes(x = value, y= year, fill = Admission,label=ifelse(value == 0, "",value)),
stat="identity",color="black")+
  geom_text(data=admissiontypeD, aes(x = value, y= year, fill = Admission,label=ifelse(value == 0, "",value)),size = 3, position = position_stack(vjust = 0.5))+
  # geom_bar(data=totaldiag %>% filter(gender=="Male"), aes(x=totalep,y=year),
  #          fill="transparent",color="black",stat="identity")+
  
  scale_y_discrete(labels = yearlabels,name="Period")+
  scale_x_continuous(name="Finished Consultant Episodes")+
  #coord_flip() + 
  scale_fill_manual(name="Admissions",values=c("#FC8D62","#E78AC3","#66C2A5","#8DA0CB")) + 
  theme_bw()+
  theme(axis.text= element_text(size=14),
        axis.title= element_text(size=14),
        legend.text = element_text(size=14),
        strip.text = element_text(size=14),
        legend.title  = element_text(size=14))

daycasesD <- associateddataD %>% 
  select(c("year","type","Code","FinEpisodes","DayCase","MedianStay","MedianWaiting")) %>% 
  group_by(year,Code)  %>% 
  mutate(Code = factor(Code,levels=transdiag,
                       labels=diaglabels))




daycase_graphD <- ggplot(daycasesD, aes(x = DayCase, y= year)) + 
  # geom_bar(data=totaldiag %>% filter(gender=="Male"), aes(x=totalep,y=year),
  #          fill="grey",color="black",stat="identity")+
  facet_grid(.~Code,scales = "free")+
  
  geom_bar(data = daycasesD %>% select(year,Code,FinEpisodes) %>% distinct() %>% rename("DayCase"=FinEpisodes),fill="transparent",color="black",linetype="dashed",position=position_dodge(0.9),stat="identity")+
  
  geom_bar(data=daycasesD, aes(x = DayCase, y= year),fill="#FFD92F",
stat="identity",color="black")+
  geom_text(data=daycasesD, aes(x = DayCase, y= year, label=ifelse(DayCase == 0, "",DayCase)),
            size = 3, position = position_stack(vjust = 0.5))+
  # geom_bar(data=totaldiag %>% filter(gender=="Male"), aes(x=totalep,y=year),
  #          fill="transparent",color="black",stat="identity")+
  
  scale_y_discrete(labels = yearlabels,name="Period")+
  scale_x_continuous(name="Finished Consultant Episodes")+ 
  theme_bw()+
  theme(axis.text= element_text(size=14),
        axis.title= element_text(size=14),
        legend.text = element_text(size=14),
        strip.text = element_text(size=14),
        legend.title  = element_text(size=14))


stay_graphD <- ggplot(daycasesD, aes(x = MedianStay, y= year)) + 
  # geom_bar(data=totaldiag %>% filter(gender=="Male"), aes(x=totalep,y=year),
  #          fill="grey",color="black",stat="identity")+
  facet_grid(.~Code,scales="free")+
  
  geom_bar(data=daycasesD, aes(x = MedianStay, y= year),fill="#FFD92F",
stat="identity",color="black")+
  geom_text(data=daycasesD, aes(x = MedianStay, y= year, label=ifelse(MedianStay == 0, "",MedianStay)),
            size = 3, position = position_stack(vjust = 0.5))+
  # geom_bar(data=totaldiag %>% filter(gender=="Male"), aes(x=totalep,y=year),
  #          fill="transparent",color="black",stat="identity")+
  
  scale_y_discrete(labels = yearlabels,name="Period")+
  scale_x_continuous(name="Median Hospital Stay (in days)")+ 
  theme_bw()+
  theme(axis.text= element_text(size=14),
        axis.title= element_text(size=14),
        legend.text = element_text(size=14),
        strip.text = element_text(size=14),
        legend.title  = element_text(size=14))


WaitingTimesbytypeD <- ggplot(daycasesD %>% select(year,Code,MedianWaiting) %>% distinct() , 
                             aes(x = MedianWaiting/7, y= year,
                                 label=ifelse(MedianWaiting == 0, "",round(MedianWaiting/7,1)))) + 
  # geom_bar(data=totaldiag %>% filter(gender=="Male"), aes(x=totalep,y=year),
  #          fill="grey",color="black",stat="identity")+
  facet_grid(.~Code)+
  geom_bar(stat="identity",color="black",fill="#FFD92F" )+
  geom_text(size = 3, position = position_stack(vjust = 0.5))+
  
  # geom_bar(data=totaldiag %>% filter(gender=="Male"), aes(x=totalep,y=year),
  #          fill="transparent",color="black",stat="identity")+
  
  scale_y_discrete(labels = yearlabels,name="Period")+
  scale_x_continuous(name="Median Waiting Time (in weeks)")+
  #coord_flip() + 
 
  theme_bw()+
  theme(axis.text= element_text(size=14),
        axis.title= element_text(size=14),
        legend.text = element_text(size=14),
        legend.title  = element_text(size=14))

detailgraphD <- plot_grid(daycase_graphD,stay_graphD,WaitingTimesbytypeD, nrow=3,labels ="AUTO")


```

As I did for procedures, I first looked at the characteristics of the episodes associated the F64 diagnoses (Admissions, Day Cases, Median Waiting Time, Median Hospital Stay). As was the case there, for diagnoses relating to gender identity, fertility and HIV age information appears routinely redacted. 

Figure \@ref(fig:admissionD) shows that the episodes associated with a F64 diagnosis resulted in admission in the vast majority of cases, with the majority of consultant episodes resulting from the patient being admitted via the waiting list. In contrast to the procedures, a number of FCEs are also planned. @HES_dictionary_2021 describes an admission by waiting list as one where the patient, at the time that the decision to admit was made, was not given a date of admittance. In contrast, for a planned admission, the patient was given a date or approximate date of admission at the time the decision was made, such as (speculating) a follow-up appointment / post-operative appointment.

&nbsp;

```{r admissionD, fig.cap = "Type of admission for the FCEs associated with a F64 diagnosis. Note, the scales differ for each diagnosis code, and dashed lines indicate the total number of FCEs.",out.width='100%', echo=FALSE,fig.height=5,fig.width=15}
admissions_graphD
```
&nbsp;

Figure \@ref(fig:detailgraphD)A shows how many of the FCEs are day cases, i.e., FCEs that did not involve an overnight stay. In contrast to the gender-confirmation procedures, a relatively large number of cases, in particular for diagnoses other than F64.0, do not result in an overnight stay. Of the gender-confirmation procedures, none have been routinely offered as day surgeries on the NHS (Note: only as of this year, some hysterectomies are routinely day surgery procedures). Given the large number of day cases, and the number of planned (likely pre or post-op) episodes, both the length of the hospital stay in Figure  \@ref(fig:detailgraphD)B and the waiting times in Figure \@ref(fig:detailgraphD)C are skewed downwards. The exception for these are single cases with F64.2 and F64.8 diagnosis which seem to be associated with particularly lengthy hospital stays.

&nbsp;

```{r detailgraphD, fig.cap = "Information associated with FCEs with a F64 diagnosis. A. Number of day cases without overnight stay. Note, the scales differ for diagnosis codes, and dashed lines indicate the total number of FCEs. B. Median Waiting Time (in weeks). C. Median length of hospital stay (in days).",out.width='100%', echo=FALSE,fig.height=12,fig.width=15}
detailgraphD
```
&nbsp;

In the analysis of procedures, we saw vastly more women are recorded as accessing gender-confirmation procedures than men. While this does not match self-reports of transgender individuals, one possibility was that this imbalance is the result of more transgender women than men seeking gender-confirmation procedures at hospital. Given the discrepancy overall in the number of episodes associated  with a particular diagnosis compared to those associated with a procedure, linking procedures and diagnoses directly is difficult as patients may return multiple times for pre-op and post-op and the actual procedure, and diagnoses do not perfectly imply procedures.

# Linking diagnoses and procedures {-}

While for the F64 diagnosis, there are more consultant episodes with a male than female gender marker, particularly in recent years, while the opposite is the case for X15 procedures. The imbalance in procedures is therefore not simply a consequence of fewer men seeing consultants at hospitals. So is there a way to estimate the number of procedures undergone by men with a F64 diagnosis, on the basis of the FCEs associated with diagnoses?

In order to venture some guess, we have to make a number of simplifying and potentially grossly wrong assumptions given the limitations of the aggregate data. While generally multiple procedures could be undergone because of the same diagnosis and multiple diagnoses can lead to the same procedure, the advantange of looking at F64 diagnoses is that they are associated with a relatively narrow number of procedures if they are coding the primary reason for admission to hospital. 

The first assumption we have to make is that every FCE associated with a procedure will also be associated with a diagnosis, while every FCE associated with a diagnosis is not necessarily associated with a procedure. That is the FCEs aggregated in the Procedure and Interventions spreadsheet are a subset of those coded in the Diagnosis spreadsheet.

The second assumption is that an admittance to hospital, resulting in a FCE, as the result of a primary F64 diagnosis is in some way, shape or form, related to gender-confirmation. This means we have to assume that a transgender man undergoing a hysterectomy as a treatment for cancer is not coded as F64, while he would be coded as F64 if he underwent the procedure as a gender confirmation surgery. The same should be true for non-procedure FCEs that appear in the Diagnosis spreadsheet.

The third assumption we have to make is that by-and-large individuals are unlikely to undergo the same gender-confirmation procedure a second time, and a particular surgery is contained in a single FCE, i.e., under the care of a single consultant. This means that while a single surgery may incur multiple FCEs (as shown in the 'Diagnosis' document), it will only incur one FCE with an attached procedure. This should be largely true for gender-confirmation surgeries, though some surgeries, notably phalloplasty surgeries, are multi-stage surgeries where individual stages are months apart and may be overseen by different consultants. This means while we are still dealing with FCEs where theoretically a single individual could be responsible for multiple FCEs with associated procedures, this should be far less likely for F64/gender-confirmation. Even if that is the case, we assume that if a FCE results in a procedure, it should appear in both spreadsheets.

Given those assumptions, there are a few possibilities of trying to work out the factor by which FCEs with diagnoses exceed those with procedures and (as we assume) diagnoses. One possibility to get a grasp of the total number of procedures we expect given the diagnoses would be to assume that the ratio of total FCEs in 'Procedure and Interventions' and 'Diagnosis' is roughly true for all FCEs, i.e., for all diagnoses associated with an episode. That is that, in 2020/21 for example, of any ~two FCEs associated with a diagnosis (~16 million), only one resulted in a recorded procedure or intervention (~9 million). 

A more data-informed approach to the problem would be to consider the characteristics we would assume to be associated with a FCE if it describes a gender-confirmation procedure. By and large, gender-confirmation surgeries as we have discussed them here so far, i.e. surgeries for the intention of gender confirmation, tend to involve overnight stays in hospital. FCEs with a F64 diagnosis but no hospital stay are therefore unlikely to indicate gender-confirmation procedures. For this approach, we can reduce the number of FCEs with a F64 diagnosis by removing the day cases from the total number of FCEs associated with a F64 diagnosis, i.e., episodes that do not incur an overnight stay. While it is not clear what these day case FCEs entail, and they may be appointments that relate to gender confirmation, they are unlikely to contain a gender-confirmation procedure. The number we have then left are FCEs with a F64 diagnosis and an overnight hospital stay. There is no guarantee that all these overnight hospital stays involved any procedure (or that day cases did not involve a procedure), but it should get us closer to the number.

Given that the removal of day cases is a little more data-informed, let us use that approach and consider how many FCEs associated with an overnight stay in hospital, by gender, are left when we consider the F64 diagnosis, and how many of these FCEs are accounted for by X15 procedures. For the removal of day cases, I removed day cases proportionally from each gender marker (this is a simplification due to the limits of the aggregate data) for each F64.x category before aggregating FCEs into the F64 group by gender marker.

```{r code6,echo=FALSE,message=FALSE,error=FALSE,warning=FALSE}


CorrectFCEs <- CollectedData %>% filter(type=="Diagnoses") %>% 
  select(year,type,Code,
         FinEpisodes,GenderMale,GenderFemale,GenderUnknown,
         DayCase) %>% 
 mutate(across(c("FinEpisodes","GenderMale","GenderFemale","GenderUnknown","DayCase"),as.numeric)) %>% 
  replace_na(list(GenderFemale=0,GenderUnknown=0)) %>% 
  mutate(NotProvided = FinEpisodes - GenderMale - GenderFemale -GenderUnknown) %>% 
  mutate(CGenderMale = GenderMale - round((DayCase * GenderMale/(GenderMale + GenderFemale+GenderUnknown + NotProvided) )),
         CGenderFemale = GenderFemale - round((DayCase * GenderFemale/(GenderMale + GenderFemale+GenderUnknown + NotProvided) )),
         CGenderUnknown = GenderUnknown- round((DayCase * GenderUnknown/(GenderMale + GenderFemale+GenderUnknown + NotProvided) )),
         CNotProvided= NotProvided- round((DayCase * NotProvided/(GenderMale + GenderFemale+GenderUnknown + NotProvided) )) ) %>% 
  
  mutate(CFinEpisodes = CGenderMale + CGenderFemale + CGenderUnknown + CNotProvided) %>% 
  mutate(CGenderMale = ifelse((FinEpisodes == CFinEpisodes & DayCase > 0),CGenderMale - DayCase,CGenderMale),
         CFinEpisodes = ifelse((FinEpisodes == CFinEpisodes & DayCase > 0),CFinEpisodes - DayCase,CFinEpisodes)) %>% 
  pivot_longer(cols=c("CGenderMale","CGenderFemale","CGenderUnknown","CNotProvided",
                      "GenderMale","GenderFemale","GenderUnknown","NotProvided"),names_to="gender",values_to="value") %>% 
  mutate(correction = ifelse(gender %in% c("CGenderMale","CGenderFemale","CGenderUnknown","CNotProvided"),"Corrected","Uncorrected")) %>% 
  group_by(year,correction,gender) %>% 
  mutate(value = as.numeric(value),
         CFinEpisodes = as.numeric(CFinEpisodes)) %>% 
  summarize(ctotalep = sum(CFinEpisodes,na.rm=T),
            
            totalep = sum(FinEpisodes),
            sumvalue = sum(value,na.rm=T)) %>% 
  mutate(gender= factor(gender,levels=c(rev(c("GenderMale","GenderUnknown","GenderFemale","NotProvided")),
                                        rev(c("CGenderMale","CGenderUnknown","CGenderFemale","CNotProvided"))),
                        labels=rep(rev(c("Male","Unknown","Female","N/A")),2)))%>% 
   mutate(year = factor(year,levels=unique(totaldiag$year),labels=yearlabels))

totalproc <- totalproc %>% mutate(year = factor(year,levels=unique(totaldiag$year),labels=yearlabels))

procedurevsdiag <- ggplot(CorrectFCEs %>% filter(correction == "Uncorrected"), aes(x = sumvalue, y=gender,fill = gender)) + 
  facet_wrap(.~year,nrow=2)+
  # geom_bar(data=totaldiag %>% filter(gender=="Male"), aes(x=totalep,y=year),
  #          fill="grey",color="black",stat="identity")+
  geom_bar(data=CorrectFCEs %>% filter(correction == "Uncorrected"), aes(x = sumvalue, y=gender),stat="identity",color="black",position=position_dodge(0.9),alpha=0.1,fill="transparent",linetype="dashed")+
   geom_bar(data=CorrectFCEs %>% filter(correction == "Corrected") , aes(x = sumvalue, y=gender,fill = gender),stat="identity",color="black",position=position_dodge(0.9),alpha=0.1,size=1)+
  geom_col_pattern(data=totalproc,aes(x=sumvalue,y=gender,fill=gender),alpha=0.3,
                   pattern="stripe",
                   pattern_fill="black",color="black", pattern_key_scale_factor = 1.2
  )+
  
  #geom_bar(data=totprocedures,aes(x=sumvalue,y=gender,fill=gensource),color="black")+
  scale_y_discrete(name="Gender Marker")+
  scale_x_continuous(name="Finished Consultant Episodes")+
  #coord_fixed(ratio = 2/1) + 
  
  theme_bw() +
  
  scale_fill_manual(name="Procedure: X15",values=c("#FC8D62","#E78AC3","#66C2A5","#8DA0CB")) + 
  theme(legend.key.size = unit(1.5, 'cm'))+
  theme(axis.text= element_text(size=14),
        axis.title= element_text(size=14),
        legend.text = element_text(size=14),
        strip.text = element_text(size=14),
        legend.title  = element_text(size=14))
  
 
 

```

&nbsp;
```{r procedurevsdiag, fig.cap = "Mapping of FCEs with X15 procedures to FCEs with F64 diagnoses. Note: the dashed line includes day cases in the FCEs associated with F64 diagnoses.",out.width='100%', echo=FALSE,fig.height=6,fig.width=15}
procedurevsdiag
```
&nbsp;

Figure\@ref(fig:procedurevsdiag) shows the FCEs associated with F64 diagnoses, and X15 procedures mapped onto them by gender. The dashed lines indicate the number of FCEs including day cases for F64 diagnoses, the solid line indicates the same with with day cases removed, and the striped area indicates the number of FCEs associated with a X15 procedure code. Removing day cases near perfectly tracks X15 procedures with a female gender marker. The disparity in the ratio of female to male gender markers associated with F64 and X15 repsectively becomes particularly apparant here: even with day cases removed, there are a number of FCEs involving an overnight stay and a F64 diagnosis that are not matched by a X15 procedure. The same is true for FCEs with an 'unknown' gender marker. 

Now - there are two possibilities: 1) overwhelmingly only women undergo gender-confirmation procedures, while FCEs for men with a F64 diagnosis and overnight stays are not associated with any procedure, 2) gender-confirmation surgeries are also coded using other procedure codes. Or indeed, the third possibility, that it is a bit both and coding convention and specificity of the surgery results in X15 being largely used to describe gender-confirmation surgeries in transgender women. So, if we assume that the X15 procedures are not the only procedures for gender-confirmation, what are the procedure codes that could subsume gender confirmation, and do the FCEs match up?

# Where are the missing procedures? Speculative exploration {-}

Eye-balling the discrepancy of diagnoses and procedures with gender-confirmation specific codes suggests that in particular surgeries for gender-confirmation in male-identified individuals are not coded using the codes suggested in the FOIA-request response. The likely explanation is that X15.x is only used for procedures that are exclusive to gender-confirmation. Of the procedures commonly available under the NHS, these are genital surgeries (removal of penis and testes, and vaginoplasty; construction of penis and scrotum). These surgeries are less common in male gender-confirmation than female gender-confirmation for a variety of reasons [@Nolan_Demographic_2019]. For men, the other available surgeries (mastectomy, hysterectomy) are not only more common than genital surgeries but also undergone by cisgender women (and cisgender men) for reasons other than gender-confirmation. Therefore it is possible that in particular for individuals with male gender markers assigned a F64 diagnosis, procedures are not coded under the X15 code but coded under the procedure code that relates to the mechanisms of the procedure directly, rather than the intention of the procedure.

In the following section, I therefore take a rough, reasonably speculative look at the procedures that could contain gender-confirmation procedures alongside non-gender-confirmation procedures. This approach is speculative for a number of reasons.

First, not all episodes recorded, even if they match the characteristics ('wrong' gender in great numbers), will be episodes of gender-confirmation procedures and interventions. Note, in particular for hysterectomies it is possible that individuals with a male or unknown gender marker undergo a hysterectomy not for gender-confirmation but for the same reasons (excision of cancer etc) that is frequently the reason for this surgery in cisgender women. In those cases, the diagnosis associated with the procedure would (or should) not be F64. Similarly some of these 'wrong gender' entries may simply be data coding errors.

Second, some procedures are undergone by cisgender men and women as well as transgender or gender non-conforming individuals, and terminology and common use may be unclear. For example, subcutaneous mastectomies can be used as treatment for breast cancer in both sexes, as treatment for gynecomastia in men, or for purposes of gender-confirmation. Taking all cross-gender instances of reasonably sex-specific procedures would therefore overstate the number of gender-confirmation procedures. Without closer examination of individual records that link diagnosis and procedure directly, it is impossible to tease apart the intention of the surgery for those generic surgery codes. That said - we can take a speculative look to get an idea of the prevalence of cross-gender instances in these generic procedure codes to guess-timate whether it is possible that these are gender-confirmation procedures.

## Alternative procedure codes {-}

I examined the codes in the OPCS-4 system that roughly capture the surgeries available to individuals for gender-confirmation on the NHS. I restricted the search to the 4-character codes that appear most likely to be used generically, rather than ones that clearly indicate, for example, removal of a lesion. A number of these codes (apart from mastectomies which occur regularly for both sexes) are marked up in the NHS Digital documents with the footnote "‡ Some 4-character codes are specific to a single gender, where every 4-character code in the reported group is specific to the same gender and an inconsistent combination of gender and code has been supplied the row has been highlighted to identify a potential recording issue," so the cross-gender nature of these procedures is generally recognized.

To find the middle ground of identifying episodes that could relate to gender confirmation while not falsely counting those that do not, I restricted the inclusion of codes in the following ways. The restrictions are based on common-sense assumptions, but may fall prey to misunderstandings about how these codes are used in practice.

* I only looked at the primary procedures and interventions. The primary procedure is the most resource-intensive procedure of a particular episode. This should largely capture gender-confirmation surgeries that are either clearly defined (mastectomy) or so specific they should have been coded under X15.1 or X15.2 (as there are no codes that otherwise appropriately describe it). That is, if procedures are used for gender-confirmation, they are unlikely to be the secondary or tertiary procedure. Naturally, there may be individual cases where that still occurs, but this should avoid capturing episodes of individuals who are not seeking gender-confirmation but may be receiving more complex surgical treatment for other reasons. This is why the numbers I show below for hysterectomy, for example, differ from those offered as a response to previous FOIA requests [@NHSDigital_FOIAHyst_2020].

* I largely focused on the main procedures in a particular group, and avoided including codes that clearly indicated removal of a lesion or similar. This is the reason why I excluded, for example, B27.4 Total mastectomy NEC. While colloquially top surgery for gender confirmation and mastectomy are used interchangeably, it is my understanding that a total mastectomy includes removal of nipple and lymphnodes. This is atypical for top surgeries.

* For hysterectomies, I only looked at codes relating to hysterectomies rather than also including salpingo-oopherectomies. For the purpose of gender-confirmation either or a combination of both is common [@Nolan_Demographic_2019], but I only coded the former for two reasons: 1) I assume that if it was a total hysterectomy with salpingo-oopherectomy, it would be coded as the former for the main procedure, and 2) there will be false positives in counting procedures here that were not undergone for gender-confirmation, so not including the additional candidate may balance these false-positives out. 

Below, I list the alternative procedure codes I included that are consistent with gender-confirmation surgeries.

* bilateral mastectomy:
    * ~~B27.4 Total mastectomy NEC~~ 
    * B27.5 Subcutaneous mastectomy 
    * B27.6 Skin-sparing mastectomy

* phalloplasty and metoidoplasty (construction of a penis, incl., if necessary, penile implants)
    * N28.1 construction of penis
    
* removal of the womb and/or ovaries and fallopian tubes (hysterectomy and/or salpingo-oophorectomy)
    * Q07.1	Abdominal hysterocolpectomy and excision of periuterine tissue					
    * Q07.2	Abdominal hysterectomy and excision of periuterine tissue NEC
    * Q07.3	Abdominal hysterocolpectomy NEC					
    * Q07.4	Total abdominal hysterectomy NEC					
    * Q07.5	Subtotal abdominal hysterectomy
    * Q07.8	Other specified abdominal excision of uterus					
    * Q07.9	Unspecified abdominal excision of uterus
    * Q08.1	Vaginal hysterocolpectomy and excision of periuterine tissue					
    * Q08.2	Vaginal hysterectomy and excision of periuterine tissue NEC
    * Q08.3	Vaginal hysterocolpectomy NEC					
    * Q08.8	Other specified vaginal excision of uterus					
    * Q08.9	Unspecified vaginal excision of uterus
    * ~~Q22.1	Bilateral salpingoophorectomy~~
    * ~~Q22.2	Bilateral salpingectomy NEC~~				
    * ~~Q22.3	Bilateral oophorectomy NEC~~		
    * ~~Q24.1	Salpingoophorectomy NEC~~ 				
    * ~~Q24.2	Salpingectomy NEC~~					
    * ~~Q24.3	Oophorectomy NEC~~ 					

* removal of testes (orchidectomy)
    * N05.1	Bilateral subcapsular orchidectomy					
    * N05.2	Bilateral orchidectomy NEC					
    * N05.3	Bilateral inguinal orchidectomy					
    * N05.8	Other specified bilateral excision of testes
    * N06.3	Orchidectomy NEC					

* removal of penis (penectomy)
    * N26.1	Total amputation of penis					
    * N26.2	Partial amputation of penis					
    * N26.8	Other specified amputation of penis					
    * N26.9	Unspecified amputation of penis					

* construction of vagina (vaginoplasty), vulva (vulvoplasty) and clitoris (clitoroplasty)
    * P21.2	Reconstruction of vagina NEC					
    * P21.3	Vaginoplasty NEC					
    * P21.5	Vaginoplasty using olive

A further group of procedures that could be undergone by individuals on a gender-confirmation pathway, though not for the intention of gender confirmation per se, is the extraction of eggs or sperm. Individuals are informed that long-term use of cross-sex hormones can reduce fertility prior to starting hormones and are typically made aware of the option of freezing eggs or sperm to retain the opportunity for reproduction at a later date. While the NHS does not cover (I believe) the extraction and freezing of eggs or sperm, individuals can opt for this procedure. It is possible that some of these procedures occur at NHS hopitals and thus would be associated with a consultant episode and possibly a F64 diagnosis as the primary diagnosis associated with this procedure.

* Q48 Oocyte recovery
* N34 Aspiration of sperm

For ease of analysis, to pay tribute to the speculative small-numbers nature, I collapsed the analysis of these codes across the groups, i.e., mastectomies are represented by the sum of episodes recorded under the B27. 5 and B27.8 code and so forth. As the overwhelming majority of episodes associated with mastectomies (~90%), hysterectomies (~99.9%) and Oocyte recovery (~99.9%) were coded with a female gender marker, and the overwhelming majority of episodes of orchidectomy (~99.5%), penectomy (> 99.9%) and Aspiration of sperm (~99%) with a male gender marker, Figure \@ref{fig:altproc} shows only the number of episodes where gender markers are consistent with the procedure being associated with a transgender individual, i.e., the gender that is 'unexpected' (unknown or cross-gender) for a particular procedure.

```{r code3, error = FALSE, warning=FALSE,message=FALSE,echo=FALSE}


altprocbytype <- CollectedData %>% filter(type=="AltProcedures") %>% 
  select(relevantcol) %>% 
  mutate(across(c("FinEpisodes","GenderMale","GenderFemale","GenderUnknown","MedianWaiting"),as.numeric)) %>% 
  replace_na(list(GenderFemale=0,GenderUnknown=0)) %>% 
  mutate(NotProvided = FinEpisodes - GenderMale - GenderFemale -GenderUnknown) %>% 
  
  pivot_longer(cols=c("GenderMale","GenderFemale","GenderUnknown","NotProvided"),names_to="gender",values_to="value") %>% 
  mutate(GroupCode = case_when(Code %in% mastectomyproc ~ "Mastectomy",
                               Code %in% phalloplastyproc ~ "Phalloplasty",
                               Code %in% hysterproc ~ "Hysterectomy",
                               Code %in% orchidectomyproc ~ "Orchidectomy",
                               Code %in% penectomyproc ~ "Penectomy",
                               Code %in% vagplasty ~ "Vaginoplasty",
                               Code %in% oocyte ~ "Oocyte recovery",
                               Code %in% sperm ~ "Aspiration of sperm",
                               TRUE ~ "NA")) %>% 
  group_by(year,GroupCode,gender) %>% 
  mutate(value = as.numeric(value),
         FinEpisodes = as.numeric(FinEpisodes)) %>% 
  summarize(totalep = sum(FinEpisodes,na.rm=T),
            sumvalue = sum(value,na.rm=T)) %>% 
  mutate(gender= factor(gender,levels=rev(c("GenderMale","GenderUnknown","GenderFemale","NotProvided")),
                        labels=rev(c("Male","Unknown","Female","N/A")))) %>% 
  mutate(GroupCode = factor(GroupCode,levels= c("Mastectomy","Phalloplasty","Hysterectomy","Oocyte recovery",
                                                "Orchidectomy","Penectomy","Vaginoplasty",
                                                "Aspiration of sperm"),
                            labels=c("Mastectomy","Phalloplasty","Hysterectomy","Oocyte recovery",
                                     "Orchidectomy","Penectomy","Vaginoplasty",
                                      "Aspiration of sperm")))


altproccodes <- altprocbytype %>% filter((GroupCode %in% c("Mastectomy","Hysterectomy","Phalloplasty","Oocyte recovery") & gender %in% c("Male","Unknown")) |
                           (GroupCode %in% c("Orchidectomy","Penectomy","Vaginoplasty","Aspiration of sperm") & gender %in% c("Female","Unknown","N/A")))

altproc_bytype<-ggplot(altproccodes, aes(x = sumvalue, y= year, fill = gender,label=ifelse(sumvalue == 0, "",sumvalue))) + 
  # geom_bar(data=totaldiag %>% filter(gender=="Male"), aes(x=totalep,y=year),
  #          fill="grey",color="black",stat="identity")+
  facet_wrap(.~GroupCode,scales = "free",nrow=2)+
  geom_bar(stat="identity",color="black",alpha=0.8)+
  geom_text(size = 3, position = position_stack(vjust = 0.5))+
  
  # geom_bar(data=totaldiag %>% filter(gender=="Male"), aes(x=totalep,y=year),
  #          fill="transparent",color="black",stat="identity")+
  
  scale_y_discrete(labels = yearlabels,name="Period")+
  scale_x_continuous(name="Finished Consultant Episodes")+
  #coord_flip() + 
  scale_fill_manual(name="Gender Marker",values=c("#FC8D62","#E78AC3","#66C2A5","#8DA0CB")) + 
  theme_bw()+
  theme(axis.text= element_text(size=14),
        axis.title= element_text(size=14),
        legend.text = element_text(size=14),
        strip.text = element_text(size=14),
        legend.title  = element_text(size=14))


```
    
&nbsp;

```{r altprocedures, fig.cap = "FCEs with cross-gender marker for select generic procedure codes by year and gender",out.width='100%', echo=FALSE,fig.height=8,fig.width=15}
altproc_bytype
```

&nbsp;


## Adding generic procedures {-}

To complete this speculative endeavour, let us put together the confirmed X15 procedures and the speculative alternative generic procedures that would fit the pattern of gender-confirmation surgeries. I omitted oocyte and sperm recovery from this graph, simply because these should be day case procedures, and we just painstakingly eliminated those from the FCEs given by the diagnoses. 

Figure \@ref(fig:procedurevsdiagALT) shows the same data for diagnoses (in pale, with thick borders) and for confirmed gender-confirmation procedures (in stripes) as Figure \@ref(fig:procedurevsdiag), though this graph shows only the FCEs with day cases removed. Additionally, the dotted pattern indicates the addition of episodes for the generic procedures.

It is plain to see that in particular for episodes for individuals with male gender marker, this adds a number of surgeries but does not follow the trend in diagnoses. In early periods I analysed (2011-2012), the number of FCEs - driven by the number of mastectomies for indviduals with male gender markers, see Figure \@ref(fig:altprocedures) - exceeds the diagnoses of F64 by a significant amount, while in more recent years it is not sufficent to account for the number of diagnoses.

Given that mastectomies are routinely used not only to treat breast cancer in men, but also gynecomastia, it is possible that the bulk of these episodes, especially at the beginning of the last decade, were accounted for by that. If that is the case, it suggests the NHS has gravely limited the number of these procedures more recently. In more recent years, the sum of generic procedure codes look like they could be a reasonable match for gender-confirmation procedures where a male-gender marker is used. Given the data, it is still unclear what the content of the FCEs are for individuals with an unknown gender marker that incur a primary F64 diagnosis, and an overnight hospital stay, but no apparent matching procedure.


```{r code4, error = FALSE, warning=FALSE,message=FALSE,echo=FALSE}

altcodesprocedures <- altproccodes %>% 
  filter(!GroupCode %in% c("Aspiration of sperm","Oocyte recovery")) %>% 
  group_by(year,gender) %>% summarize(sums = sum(sumvalue)) %>% 
  rename("sumvalue" = sums) %>% mutate(source = "alt") %>% 
   mutate(year = factor(year,levels=unique(totaldiag$year),labels=yearlabels))

x15procedures <-  totalproc %>%  mutate(source = "x15") 

totprocedures <- bind_rows(altcodesprocedures,x15procedures) %>% mutate(gensource = paste0(gender,"_",source))

diagforproc <- CorrectFCEs %>% filter(correction == "Corrected") %>% 
  mutate(gensource = paste0(gender,"_","x15"))
#totalproc <- totalproc %>% mutate(year=factor(year,levels=unique(totaldiag$year),labels=yearlabels))

procedurevsdiagALT <- ggplot(diagforproc, aes(x = sumvalue, y=gender,fill = gender,label=ifelse(sumvalue == 0, "",sumvalue))) + 
  facet_wrap(.~year,nrow=2)+
  # geom_bar(data=totaldiag %>% filter(gender=="Male"), aes(x=totalep,y=year),
  #          fill="grey",color="black",stat="identity")+
  geom_bar(stat="identity",color="black",position=position_dodge(0.9),alpha=0.1,size=1)+
  geom_col_pattern(data=totprocedures,aes(x=sumvalue,y=gender,fill=gender, pattern=as.factor(source)),alpha=0.3,pattern_fill="black",color="black",
                   pattern_key_scale_factor = 1.2
  )+
  
  #geom_bar(data=totprocedures,aes(x=sumvalue,y=gender,fill=gensource),color="black")+
  scale_y_discrete(name="Gender Marker")+
  scale_x_continuous(name="Finished Consultant Episodes")+
  #coord_fixed(ratio = 2/1) + 
  
  theme_bw() +
  scale_pattern_discrete(name = "Procedures",labels=c("Generic","X15"),choices=c("circle","stripe"),guide="legend")+
  scale_fill_manual(name="Gender Marker",values=c("#FC8D62","#E78AC3","#66C2A5","#8DA0CB")) + 
  theme(legend.key.size = unit(1.5, 'cm'))+
  theme(axis.text= element_text(size=14),
        axis.title= element_text(size=14),
        strip.text = element_text(size=14),
        legend.text = element_text(size=14),
        legend.title  = element_text(size=14))
  


```

&nbsp;

```{r procedurevsdiagALT, fig.cap = "Mapping of FCEs with X15 procedures and generic procedure codes to FCEs with F64 diagnoses (without day cases).",out.width='100%', echo=FALSE,fig.height=8,fig.width=15}
procedurevsdiagALT
```

&nbsp;

# Summary {-}

## What we know {-}

We know that the NHS publishes aggregated hospital episode records, that contain some data for episodes associated with a primary F64 diagnosis, and contain some data with gender-confirmation procedures. According to the documents accompanying these reports, where a primary procedure is recorded for a particular Finished Consultant Episode, it was the most resource-intensive procedure in that episode. Where a particular primary diagnosis is recorded, it was the main reason for the admittance to hospital / for the particular consultant episode. What we also know is that the numbers do not quite match up. The published records are aggregated by diagnosis and procedure respectively.

Over the last decade, the episodes associated with a F64 (gender identity disorder) diagnosis have increased in number, driven to some degree by episodes / individuals represented by a male gender-marker. There are some curiuos outliers: 2020/21, the COVID-19 financial year, shows an unprecedented number of hospital episodes with F64.9 diagnoses, associated with an unknown gender marker, but no overnight stay in hospital. It is possible that hospitals and their consultants picked up the slack of GICs reducing the patients they were seeing during the pandemic (or consultants operated out of hospitals rather than gender clinics), but from the aggregated records, it is not clear what the reason for those hospital episodes was.

Given that F64 primary diagnoses and X15 primary procedures should go hand-in-hand, one would assume that mapping the two, even with aggregate episode records, should be possible. That is, I expected that even if non-procedure diagnosis records exceed procedures, this would be balanced across, for example, gender markers. This was not the case. With some corrective factor, F64 and X15 track one another relatively well for women seeking gender-confirmation but do not do so for men (or individuals with unknown gender). In fact for male gender-confirmation hardly any, especially given the overnight hospital episodes associated with F64 diagnoses, appropriate X15 procedures are being recorded.

## What we do not know {-}

What we do not know is the rest of this puzzle.

I made a number of reasonable assumptions as to what may happen in practice when hospital episodes are coded. It seems likely, given the lack of alternative, that X15 procedures codes are in practice only used to code genital surgeries. This is possibly as a function of the generic procedures being more familiar and accessible at the time of coding, where possible. This would mean that even with a F64 diagnosis, gender-confirmation procedures that are not genital surgeries, are otherwise coded as the generic procedure code that describes the mechanics of the surgery, and X15 is only used as the last option.

If this is the case, the numbers roughly track with the NHS routinely only covering genital surgery for women, covering both genital and other surgery for men, and transgender men being less likely to access genital surgery. While, without further inspection of individual-level records, teasing apart just how those surgeries are recorded is not possible, the rough estimate I showed here seems to more or less match that story.

In a sense, this is not problematic. A number of transgender individuals will likely appreciate that their procedure is not coded as a 'Sexual transformation from female to male' but is simply coded as the procedure it is, as a way to normalize surgical gender confirmation. The problem with the odds and ends of this puzzle is that it makes it impossible to infer any information about the prevalence of surgical procedures, or the associated characteristics of these procedures (such as waiting times). The response to the FOIA request I showed above suggested that these records offer information about the waiting times for treatment - but they do not.

Not only is it unclear which procedures are contained in the codes, at least for the procedures associated with male gender markers, the numbers in the X15 codes are too small to conclude anything. Eyeballing the waiting times, it seems likely that they are the waiting times for genital surgery as there is only a single team in the NHS that carries out that procedure and the waiting times - anecdotally - track. I refrained from discussing the waiting times for the generic procedures, only because they likely combine surgeries for the treatment of cancer, cosmetic surgeries for gynecomastia and top surgeries in the case of mastectomies, and surgeries for the treatment of cancer, pain and gender-confirmation for hysterectomies. It seems unlikely that the waiting times for these are comparable. Rather I would expect a bimodal distribution here, where waiting times are much shorter for cancer treatments. If that is the case, analysing the waiting time without considering the underlying diagnoses, skews the inference: the wait for cancer treatment will appear longer than it is, and the wait for gender confirmation shorter than it is.

This is not to say that the information about the prevalence and waiting times does not exist. I am reasonably confident that on a record-level, this can be teased apart further to provide a more accurate pictue. But to suggest that all the information is in the X15 codes, and readily available, is disingenuous.

## Alternative takes {-}

I glossed over a number of alternative possibilities throughout, but let me briefly mention them here and discuss why I believe they are unlikely explanations, given my understanding of the data. 

While I was careful to keep in mind that FCEs do not equal individuals, it is possible that this accounts for a much greater chunk of the data that seems to be missing. I would be more confident that this is the case if there were not so few FCEs associated with X15.2, the code for the transformation from female to male.

I made a number of assumptions, most gravely that FCEs with a procedure are contained fully, in a Venn-diagram sense, in the circle for FCEs with a diagnosis. This is my common-sense understanding of the data, but may not actually reflect the reality of the situation. The analyses of trying to find 'missing' procedures is predicated on this assumption. If this is not the case, the second half of this write-up is even more speculative that I set out.

I matched FCEs for diagnoses and procedures because there should be a relationship. Though note, even where the numbers look to make some sense, bear in mind that these numbers are different aggregated entitities. It is possible that the link between F64 and X15 or other procedures is much looser. In the data I analysed, those two entities are never linked directly. This means that X15 procedures being mapped onto F64 diagnoses may simply map entirely disparate FCEs. That said - it would be odd if there was no overlap between the data in both spreadsheets, but that does not mean it is impossible. 

While I only analysed primary codes in either case, it is possible that primary F64 diagnosis codes were listed even where this was not actually the primary reason for an overnight hospital stay. A number of scenarios come to mind where this mix-up could occur. I mentioned cancer treatment of a transgender individual before. Others could be mental health emergencies that are coded as F64, rather than a particular mental health episode, or any other hospital admittance of a transgender individual for some other medical reason. The reason for this must not even be particularly malignant on the part of the hospital employees. Where this is coded in the NHS record during the stay, it may simply be there to alert other staff of appropriate pronoun use or to remember to use different norms when interpreting medical tests where necessary.

I lack the full understanding as to why transgender individuals may be seen in hospital. I made the assumption here that these episodes would be associated with procedures in some fashion, i.e., conversations with consultants before and after, multi-stage procedures or revisions to procedures that have already occurred. It is possible that a number of FCEs are accounted for by something else. The number of day cases in episodes with F64 diagnoses suggest that these may be diagnostic appointments, or appointments with endocrinologists or similar, that just happen to occur at a hospital. But this does not explain the number of episodes with overnight stays.

Finally, if unlikely, it is possible that the NHS only covers this many procedures for transgender men in a financial year, and the F64 overnight appointments have some other explanation. Given the long waiting times for access to trans health care (meaning mostly accessing apppointments at a GIC) in the NHS, many individuals choose to access trans health care, including hormone treatments and surgical procedures privately within the UK or abroad. As is the case within the NHS, private surgical procedures require assessments and referral letters but access to them can be at much shorter time scale. Within the UK, these surgical procedures are administered by surgeons who work both within the NHS and privately. Where they work privately, the care may be within NHS hospitals (and they would show up in the hospital records) or within private hospitals (and the records would not show up). Where individuals go abroad for surgical procedures for cost or expertise, these records naturally do not show up. The summary here therefore reflects only hospital episodes where individuals accessed care largely through the NHS pathway, or where surgeons operate privately at NHS hospitals. It is possible that this only reflects that the prevalence of private surgical care is much greater than I would assume.

# Input welcome {-}

This started as a free-time project because in my job I play with data but I rarely get to play with applied data, and this seemed data relevant to my interests. I expected that I'd find an increase in transgender individuals accessing NHS care across the years, and that I'd show that waiting times are pretty long. I did not expect that it would turn into a bit of a scavenger hunt. That said, I am not a medic. A lot of the data assumptions I make are based on my knowledge of data. A lot of the medical and coding assumptions I made are based either on common-sense or a reasonable knowledge of the hospital care transgender people routinely access. It is fully possible that I am simply completely missing something that is very obvious to someone in the field. Any feedback, comments on or corrections of misunderstandings on my part are welcome.

# References

